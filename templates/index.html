<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Voice Agent - Real-Time Streaming</title>
    <link rel="stylesheet" href="/static/style.css" />
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Highlight.js for code syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üî¥ Live AI Voice Agent</h1>
        <p class="subtitle">
          Speak, stream, and listen ‚Äî AI that responds as you talk
        </p>
        <div class="header-controls">
          <button id="configBtn" class="config-btn" title="Configure API Keys">
            <span class="config-icon">‚öôÔ∏è</span>
            Config
          </button>
        </div>
      </header>

      <main class="live-voice-agent-section">
        <div class="card">
          <h1>Real-Time Conversation</h1>
          <p>
            Press the mic button and chat freely with your AI assistant. Every
            exchange is captured and stored as part of your session history.
          </p>

          <!-- API Keys Status Notice -->
          <div id="apiKeyNotice" class="api-key-notice" style="display: none">
            <div class="notice-content">
              <span class="notice-icon">‚ö†Ô∏è</span>
              <span class="notice-text"
                >API keys required to use the voice agent.</span
              >
              <button id="openConfigFromNotice" class="notice-btn">
                Configure Now
              </button>
            </div>
          </div>

          <div class="session-info">
            <small
              >Active Session:
              <span id="sessionId">{{ session_id }}</span></small
            >
            <div class="chat-history-toggle">
              <button id="toggleChatHistory" class="btn-toggle">
                Toggle Chat History
              </button>
            </div>
          </div>

          <div
            id="chatHistoryContainer"
            class="chat-history-container"
            style="display: none"
          >
            <h4>Session Transcript:</h4>
            <div id="chatHistoryList" class="chat-history-list">
              <!-- Chat history will be populated here -->
            </div>
          </div>

          <div class="streaming-info">
            <div class="status-indicator">
              <span id="connectionStatus" class="status-badge disconnected"
                >Disconnected</span
              >
              <span id="currentPersona" class="persona-badge">Developer</span>
              <small id="streamingSessionId" class="streaming-session"></small>
            </div>
          </div>

          <div class="controls">
            <!-- Weather instruction panel -->
            <div
              id="weatherInstructionPanel"
              class="weather-instruction-panel"
              style="display: none"
            >
              <div class="instruction-content">
                <div class="instruction-icon">üé§</div>
                <h4>Weather Mode Active</h4>
                <p><strong>Only speak the location name</strong></p>
                <p class="instruction-examples">
                  Examples: "Mumbai", "New York", "London", "Tokyo"
                </p>
              </div>
            </div>

            <div class="persona-selection">
              <label for="personaSelect">AI Persona:</label>
              <select id="personaSelect" class="persona-dropdown">
                <option value="developer" selected>Developer (Default)</option>
                <option value="jack">Captain Jack Sparrow</option>
                <option value="vegeta">Vegeta</option>
                <option value="goku">Goku</option>
                <option value="luffy">Monkey D. Luffy (One Piece)</option>
              </select>
            </div>

            <div class="button-group">
              <button
                id="getMotivationBtn"
                class="btn secondary motivation-btn"
                data-state="ready"
                data-tooltip="Get an inspiring motivational quote!"
              >
                <span class="btn-icon">üí™</span>
                <span class="btn-text">Get Motivation</span>
              </button>
              <button
                id="getWeatherBtn"
                class="btn secondary weather-btn"
                data-state="ready"
                title="Click to activate weather mode - you'll only need to speak the location name"
              >
                <span class="btn-icon">üå§Ô∏è</span>
                <span class="btn-text">Get Weather Info</span>
              </button>
              <button
                id="audioStreamBtn"
                class="btn primary"
                data-state="ready"
              >
                <span class="btn-icon">üé§</span>
                <span class="btn-text">Start Voice Streaming</span>
              </button>
            </div>
          </div>

          <div
            id="audioStreamStatus"
            class="streaming-status-container"
            style="display: none"
          >
            <h4>Streaming Updates:</h4>
            <div id="streamingStatusLog" class="status-log"></div>
          </div>

          <div
            id="audioPlaybackStatus"
            class="audio-playback-container"
            style="display: none"
          >
            <h4>üîä AI Audio Response:</h4>
            <div class="playback-indicator">
              <div class="audio-wave-animation">
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
                <div class="wave-bar"></div>
              </div>
              <span id="playbackStatusText">Streaming audio response...</span>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- API Configuration Modal -->
    <div id="configModal" class="modal" style="display: none">
      <div class="modal-content config-modal">
        <div class="modal-header">
          <h3>üîß API Configuration</h3>
          <button id="closeConfigModal" class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="api-keys-notice">
            <p>
              <strong>‚ö†Ô∏è API Keys Required:</strong> You must provide your own
              API keys to use this voice agent. The system will not function
              without them.
            </p>
          </div>
          <div class="config-form-container">
            <div class="config-form">
              <div class="config-section">
                <h4>ü§ñ AI & Speech Services (Required)</h4>
                <div class="form-group">
                  <label for="geminiApiKey"
                    >Gemini API Key: <span class="required">*</span></label
                  >
                  <input
                    type="password"
                    id="geminiApiKey"
                    placeholder="Enter your Gemini API key"
                    required
                  />
                  <small>For LLM (Language Model) responses</small>
                </div>
                <div class="form-group">
                  <label for="assemblyaiApiKey"
                    >AssemblyAI API Key: <span class="required">*</span></label
                  >
                  <input
                    type="password"
                    id="assemblyaiApiKey"
                    placeholder="Enter your AssemblyAI API key"
                    required
                  />
                  <small>For Speech-to-Text transcription</small>
                </div>
                <div class="form-group">
                  <label for="murfApiKey"
                    >Murf API Key: <span class="required">*</span></label
                  >
                  <input
                    type="password"
                    id="murfApiKey"
                    placeholder="Enter your Murf API key"
                    required
                  />
                  <small>For Text-to-Speech generation</small>
                </div>
                <div class="form-group">
                  <label for="murfVoiceId">Murf Voice ID:</label>
                  <input
                    type="text"
                    id="murfVoiceId"
                    placeholder="e.g., en-IN-aarav"
                    value="en-IN-aarav"
                  />
                  <small>Voice ID for TTS generation</small>
                </div>
              </div>

              <div class="config-section">
                <h4>üå§Ô∏è Additional Services (Optional)</h4>
                <div class="form-group">
                  <label for="openweatherApiKey">OpenWeather API Key:</label>
                  <input
                    type="password"
                    id="openweatherApiKey"
                    placeholder="Enter your OpenWeather API key"
                  />
                  <small>For weather information (optional)</small>
                </div>
              </div>

              <div
                class="config-status"
                id="configStatus"
                style="display: none"
              >
                <div class="status-message"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="saveConfigBtn" class="btn primary">
            Save Configuration
          </button>
          <button id="testConfigBtn" class="btn secondary">
            Test Services
          </button>
          <button id="configCancelBtn" class="btn secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Conversation Detail Modal -->
    <div id="conversationModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Conversation History</h3>
          <button id="closeModal" class="modal-close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="modal-conversation">
            <div class="modal-question">
              <h4>üë§ You Said:</h4>
              <div
                id="modalQuestionContent"
                class="modal-message-content"
              ></div>
            </div>
            <div class="modal-response">
              <h4>>ü§ñ AI Replied:</h4>
              <div
                id="modalResponseContent"
                class="modal-message-content"
              ></div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="modalCloseBtn" class="btn secondary">Close</button>
        </div>
      </div>
    </div>

    <script>
      // Set session ID globally for JavaScript
      window.SESSION_ID = "{{ session_id }}";
    </script>
    <script src="/static/app.js"></script>
  </body>
</html>
